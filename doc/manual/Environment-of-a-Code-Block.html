<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- This manual is for Org version 9.3.

Copyright (C) 2004-2019  Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with no
Invariant Sections, with the Front-Cover Texts being "A GNU Manual,"
and with the Back-Cover Texts as in (a) below.  A copy of the license
is included in the section entitled "GNU Free Documentation License."

(a) The FSF's Back-Cover Text is: "You have the freedom to copy and
modify this GNU manual."
 -->
<!-- Created by GNU Texinfo 6.5, http://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Environment of a Code Block (The Org Manual)</title>

<meta name="description" content="Environment of a Code Block (The Org Manual)">
<meta name="keywords" content="Environment of a Code Block (The Org Manual)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html#Top" rel="start" title="Top">
<link href="Main-Index.html#Main-Index" rel="index" title="Main Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Working-with-Source-Code.html#Working-with-Source-Code" rel="up" title="Working with Source Code">
<link href="Evaluating-Code-Blocks.html#Evaluating-Code-Blocks" rel="next" title="Evaluating Code Blocks">
<link href="Using-Header-Arguments.html#Using-Header-Arguments" rel="prev" title="Using Header Arguments">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
blockquote.smallindentedblock {margin-right: 0em; font-size: smaller}
blockquote.smallquotation {font-size: smaller}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
div.smalldisplay {margin-left: 3.2em}
div.smallexample {margin-left: 3.2em}
div.smalllisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
pre.smalldisplay {font-family: inherit; font-size: smaller}
pre.smallexample {font-size: smaller}
pre.smallformat {font-family: inherit; font-size: smaller}
pre.smalllisp {font-size: smaller}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>


</head>

<body lang="en">
<a name="Environment-of-a-Code-Block"></a>
<div class="header">
<p>
Next: <a href="Evaluating-Code-Blocks.html#Evaluating-Code-Blocks" accesskey="n" rel="next">Evaluating Code Blocks</a>, Previous: <a href="Using-Header-Arguments.html#Using-Header-Arguments" accesskey="p" rel="prev">Using Header Arguments</a>, Up: <a href="Working-with-Source-Code.html#Working-with-Source-Code" accesskey="u" rel="up">Working with Source Code</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Main-Index.html#Main-Index" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<a name="Environment-of-a-Code-Block-1"></a>
<h3 class="section">15.3 Environment of a Code Block</h3>



<a name="Passing-arguments"></a><a name="Passing-arguments-1"></a>
<h4 class="subheading">Passing arguments</h4>

<a name="index-passing-arguments-to-code-blocks"></a>
<a name="index-arguments_002c-in-code-blocks"></a>
<a name="index-var_002c-header-argument"></a>
<p>Use &lsquo;<samp>var</samp>&rsquo; for passing arguments to source code blocks.  The specifics
of variables in code blocks vary by the source language and are
covered in the language-specific documentation.  The syntax for &lsquo;<samp>var</samp>&rsquo;,
however, is the same for all languages.  This includes declaring
a variable, and assigning a default value.
</p>
<p>The following syntax is used to pass arguments to code blocks using
the &lsquo;<samp>var</samp>&rsquo; header argument.
</p>
<div class="example">
<pre class="example">:var NAME=ASSIGN
</pre></div>


<p><var>NAME</var> is the name of the variable bound in the code block
body.  <var>ASSIGN</var> is a literal value, such as a string,
a number, a reference to a table, a list, a literal example, another
code block&mdash;with or without arguments&mdash;or the results of evaluating
a code block.
</p>
<p>Here are examples of passing values by reference:
</p>
<dl compact="compact">
<dt>table</dt>
<dd><p>A table named with a &lsquo;<samp>NAME</samp>&rsquo; keyword.
</p>
<div class="example">
<pre class="example">#+NAME: example-table
| 1 |
| 2 |
| 3 |
| 4 |

#+NAME: table-length
#+BEGIN_SRC emacs-lisp :var table=example-table
  (length table)
#+END_SRC

#+RESULTS: table-length
: 4
</pre></div>

<p>When passing a table, you can treat specially the row, or the
column, containing labels for the columns, or the rows, in the
table.
</p>
<a name="index-colnames_002c-header-argument"></a>
<p>The &lsquo;<samp>colnames</samp>&rsquo; header argument accepts &lsquo;<samp>yes</samp>&rsquo;, &lsquo;<samp>no</samp>&rsquo;, or &lsquo;<samp>nil</samp>&rsquo; values.
The default value is &lsquo;<samp>nil</samp>&rsquo;: if an input table has column
names&mdash;because the second row is a horizontal rule&mdash;then Org
removes the column names, processes the table, puts back the column
names, and then writes the table to the results block.  Using &lsquo;<samp>yes</samp>&rsquo;,
Org does the same to the first row, even if the initial table does
not contain any horizontal rule.  When set to &lsquo;<samp>no</samp>&rsquo;, Org does not
pre-process column names at all.
</p>
<div class="example">
<pre class="example">#+NAME: less-cols
| a |
|---|
| b |
| c |

#+BEGIN_SRC python :var tab=less-cols :colnames nil
  return [[val + '*' for val in row] for row in tab]
#+END_SRC

#+RESULTS:
| a  |
|----|
| b* |
| c* |
</pre></div>

<a name="index-rownames_002c-header-argument"></a>
<p>Similarly, the &lsquo;<samp>rownames</samp>&rsquo; header argument can take two values: &lsquo;<samp>yes</samp>&rsquo;
or &lsquo;<samp>no</samp>&rsquo;.  When set to &lsquo;<samp>yes</samp>&rsquo;, Org removes the first column, processes
the table, puts back the first column, and then writes the table to
the results block.  The default is &lsquo;<samp>no</samp>&rsquo;, which means Org does not
pre-process the first column.  Note that Emacs Lisp code blocks
ignore &lsquo;<samp>rownames</samp>&rsquo; header argument because of the ease of
table-handling in Emacs.
</p>
<div class="example">
<pre class="example">#+NAME: with-rownames
| one | 1 | 2 | 3 | 4 |  5 |
| two | 6 | 7 | 8 | 9 | 10 |

#+BEGIN_SRC python :var tab=with-rownames :rownames yes
  return [[val + 10 for val in row] for row in tab]
#+END_SRC

#+RESULTS:
| one | 11 | 12 | 13 | 14 | 15 |
| two | 16 | 17 | 18 | 19 | 20 |
</pre></div>

</dd>
<dt>list</dt>
<dd><p>A simple named list.
</p>
<div class="example">
<pre class="example">#+NAME: example-list
- simple
  - not
  - nested
- list

#+BEGIN_SRC emacs-lisp :var x=example-list
  (print x)
#+END_SRC

#+RESULTS:
| simple | list |
</pre></div>

<p>Note that only the top level list items are passed along.  Nested
list items are ignored.
</p>
</dd>
<dt>code block without arguments</dt>
<dd><p>A code block name, as assigned by &lsquo;<samp>NAME</samp>&rsquo; keyword from the example
above, optionally followed by parentheses.
</p>
<div class="example">
<pre class="example">#+BEGIN_SRC emacs-lisp :var length=table-length()
  (* 2 length)
#+END_SRC

#+RESULTS:
: 8
</pre></div>

</dd>
<dt>code block with arguments</dt>
<dd><p>A code block name, as assigned by &lsquo;<samp>NAME</samp>&rsquo; keyword, followed by
parentheses and optional arguments passed within the parentheses.
</p>
<div class="example">
<pre class="example">#+NAME: double
#+BEGIN_SRC emacs-lisp :var input=8
  (* 2 input)
#+END_SRC

#+RESULTS: double
: 16

#+NAME: squared
#+BEGIN_SRC emacs-lisp :var input=double(input=1)
  (* input input)
#+END_SRC

#+RESULTS: squared
: 4
</pre></div>

</dd>
<dt>literal example</dt>
<dd><p>A literal example block named with a &lsquo;<samp>NAME</samp>&rsquo; keyword.
</p>
<div class="example">
<pre class="example">#+NAME: literal-example
#+BEGIN_EXAMPLE
  A literal example
  on two lines
#+END_EXAMPLE

#+NAME: read-literal-example
#+BEGIN_SRC emacs-lisp :var x=literal-example
  (concatenate #'string x &quot; for you.&quot;)
#+END_SRC

#+RESULTS: read-literal-example
: A literal example
: on two lines for you.
</pre></div>
</dd>
</dl>

<p>Indexing variable values enables referencing portions of a variable.
Indexes are 0 based with negative values counting backwards from the
end.  If an index is separated by commas then each subsequent section
indexes as the next dimension.  Note that this indexing occurs
<em>before</em> other table-related header arguments are applied, such as
&lsquo;<samp>hlines</samp>&rsquo;, &lsquo;<samp>colnames</samp>&rsquo; and &lsquo;<samp>rownames</samp>&rsquo;.  The following example assigns
the last cell of the first row the table &lsquo;<samp>example-table</samp>&rsquo; to the
variable &lsquo;<samp>data</samp>&rsquo;:
</p>
<div class="example">
<pre class="example">#+NAME: example-table
| 1 | a |
| 2 | b |
| 3 | c |
| 4 | d |

#+BEGIN_SRC emacs-lisp :var data=example-table[0,-1]
  data
#+END_SRC

#+RESULTS:
: a
</pre></div>

<p>Two integers separated by a colon reference a range of variable
values.  In that case the entire inclusive range is referenced.  For
example the following assigns the middle three rows of &lsquo;<samp>example-table</samp>&rsquo;
to &lsquo;<samp>data</samp>&rsquo;.
</p>
<div class="example">
<pre class="example">#+NAME: example-table
| 1 | a |
| 2 | b |
| 3 | c |
| 4 | d |
| 5 | 3 |

#+BEGIN_SRC emacs-lisp :var data=example-table[1:3]
  data
#+END_SRC

#+RESULTS:
| 2 | b |
| 3 | c |
| 4 | d |
</pre></div>

<p>To pick the entire range, use an empty index, or the single character
&lsquo;<samp>*</samp>&rsquo;.  &lsquo;<samp>0:-1</samp>&rsquo; does the same thing.  Example below shows how to
reference the first column only.
</p>
<div class="example">
<pre class="example">#+NAME: example-table
| 1 | a |
| 2 | b |
| 3 | c |
| 4 | d |

#+BEGIN_SRC emacs-lisp :var data=example-table[,0]
  data
#+END_SRC

#+RESULTS:
| 1 | 2 | 3 | 4 |
</pre></div>

<p>Index referencing can be used for tables and code blocks.  Index
referencing can handle any number of dimensions.  Commas delimit
multiple dimensions, as shown below.
</p>
<div class="example">
<pre class="example">#+NAME: 3D
#+BEGIN_SRC emacs-lisp
  '(((1  2  3)  (4  5  6)  (7  8  9))
    ((10 11 12) (13 14 15) (16 17 18))
    ((19 20 21) (22 23 24) (25 26 27)))
#+END_SRC

#+BEGIN_SRC emacs-lisp :var data=3D[1,,1]
  data
#+END_SRC

#+RESULTS:
| 11 | 14 | 17 |
</pre></div>

<p>Note that row names and column names are not removed prior to variable
indexing.  You need to take them into account, even when &lsquo;<samp>colnames</samp>&rsquo; or
&lsquo;<samp>rownames</samp>&rsquo; header arguments remove them.
</p>
<p>Emacs lisp code can also set the values for variables.  To
differentiate a value from Lisp code, Org interprets any value
starting with &lsquo;<samp>(</samp>&rsquo;, &lsquo;<samp>[</samp>&rsquo;, &lsquo;<samp>'</samp>&rsquo; or &lsquo;<samp>`</samp>&rsquo; as Emacs Lisp code.  The result of
evaluating that code is then assigned to the value of that variable.
The following example shows how to reliably query and pass the file
name of the Org mode buffer to a code block using headers.  We need
reliability here because the file&rsquo;s name could change once the code in
the block starts executing.
</p>
<div class="example">
<pre class="example">#+BEGIN_SRC sh :var filename=(buffer-file-name) :exports both
  wc -w $filename
#+END_SRC
</pre></div>

<p>Note that values read from tables and lists are not mistakenly
evaluated as Emacs Lisp code, as illustrated in the following example.
</p>
<div class="example">
<pre class="example">#+NAME: table
| (a b c) |

#+HEADER: :var data=table[0,0]
#+BEGIN_SRC perl
  $data
#+END_SRC

#+RESULTS:
: (a b c)
</pre></div>

<a name="Using-sessions"></a><a name="Using-sessions-1"></a>
<h4 class="subheading">Using sessions</h4>

<a name="index-using-sessions-in-code-blocks"></a>
<a name="index-session_002c-header-argument"></a>
<p>Two code blocks can share the same environment.  The &lsquo;<samp>session</samp>&rsquo; header
argument is for running multiple source code blocks under one session.
Org runs code blocks with the same session name in the same
interpreter process.
</p>
<dl compact="compact">
<dt>&lsquo;<samp>none</samp>&rsquo;</dt>
<dd><p>Default.  Each code block gets a new interpreter process to execute.
The process terminates once the block is evaluated.
</p>
</dd>
<dt><var>STRING</var></dt>
<dd><p>Any string besides &lsquo;<samp>none</samp>&rsquo; turns that string into the name of that
session.  For example, &lsquo;<samp>:session STRING</samp>&rsquo; names it &lsquo;<samp>STRING</samp>&rsquo;.  If
&lsquo;<samp>session</samp>&rsquo; has no value, then the session name is derived from the
source language identifier.  Subsequent blocks with the same source
code language use the same session.  Depending on the language,
state variables, code from other blocks, and the overall interpreted
environment may be shared.  Some interpreted languages support
concurrent sessions when subsequent source code language blocks
change session names.
</p></dd>
</dl>

<p>Only languages that provide interactive evaluation can have session
support.  Not all languages provide this support, such as C and ditaa.
Even languages, such as Python and Haskell, that do support
interactive evaluation impose limitations on allowable language
constructs that can run interactively.  Org inherits those limitations
for those code blocks running in a session.
</p>
<a name="Choosing-a-working-directory"></a><a name="Choosing-a-working-directory-1"></a>
<h4 class="subheading">Choosing a working directory</h4>

<a name="index-working-directory_002c-in-a-code-block"></a>
<a name="index-dir_002c-header-argument"></a>
<a name="index-mkdirp_002c-header-argument"></a>
<p>The &lsquo;<samp>dir</samp>&rsquo; header argument specifies the default directory during code
block execution.  If it is absent, then the directory associated with
the current buffer is used.  In other words, supplying &lsquo;<samp>:dir
DIRECTORY</samp>&rsquo; temporarily has the same effect as changing the current
directory with <kbd>M-x cd <span class="key">RET</span> DIRECTORY</kbd>, and then not setting
&lsquo;<samp>dir</samp>&rsquo;.  Under the surface, &lsquo;<samp>dir</samp>&rsquo; simply sets the value of the Emacs
variable <code>default-directory</code>.  Setting &lsquo;<samp>mkdirp</samp>&rsquo; header argument to
a non-<code>nil</code> value creates the directory, if necessary.
</p>
<p>For example, to save the plot file in the &lsquo;<samp>Work/</samp>&rsquo; folder of the home
directory&mdash;notice tilde is expanded:
</p>
<div class="example">
<pre class="example">#+BEGIN_SRC R :file myplot.png :dir ~/Work
  matplot(matrix(rnorm(100), 10), type=&quot;l&quot;)
#+END_SRC
</pre></div>

<p>To evaluate the code block on a remote machine, supply a remote
directory name using Tramp syntax.  For example:
</p>
<div class="example">
<pre class="example">#+BEGIN_SRC R :file plot.png :dir /scp:dand@yakuba.princeton.edu:
  plot(1:10, main=system(&quot;hostname&quot;, intern=TRUE))
#+END_SRC
</pre></div>

<p>Org first captures the text results as usual for insertion in the Org
file.  Then Org also inserts a link to the remote file, thanks to
Emacs Tramp.  Org constructs the remote path to the file name from
&lsquo;<samp>dir</samp>&rsquo; and <code>default-directory</code>, as illustrated here:
</p>
<div class="example">
<pre class="example">[[file:/scp:dand@yakuba.princeton.edu:/home/dand/plot.png][plot.png]]
</pre></div>


<p>When &lsquo;<samp>dir</samp>&rsquo; is used with &lsquo;<samp>session</samp>&rsquo;, Org sets the starting directory for
a new session.  But Org does not alter the directory of an already
existing session.
</p>
<p>Do not use &lsquo;<samp>dir</samp>&rsquo; with &lsquo;<samp>:exports results</samp>&rsquo; or with &lsquo;<samp>:exports both</samp>&rsquo; to
avoid Org inserting incorrect links to remote files.  That is because
Org does not expand <code>default directory</code> to avoid some underlying
portability issues.
</p>
<a name="Inserting-headers-and-footers"></a><a name="Inserting-headers-and-footers-1"></a>
<h4 class="subheading">Inserting headers and footers</h4>

<a name="index-headers_002c-in-code-blocks"></a>
<a name="index-footers_002c-in-code-blocks"></a>
<a name="index-prologue_002c-header-argument"></a>
<p>The &lsquo;<samp>prologue</samp>&rsquo; header argument is for appending to the top of the code
block for execution, like a reset instruction.  For example, you may
use &lsquo;<samp>:prologue &quot;reset&quot;</samp>&rsquo; in a Gnuplot code block or, for every such
block:
</p>
<div class="lisp">
<pre class="lisp">(add-to-list 'org-babel-default-header-args:gnuplot
             '((:prologue . &quot;reset&quot;)))

</pre></div>

<a name="index-epilogue_002c-header-argument"></a>
<p>Likewise, the value of the &lsquo;<samp>epilogue</samp>&rsquo; header argument is for appending
to the end of the code block for execution.
</p>
<hr>
<div class="header">
<p>
Next: <a href="Evaluating-Code-Blocks.html#Evaluating-Code-Blocks" accesskey="n" rel="next">Evaluating Code Blocks</a>, Previous: <a href="Using-Header-Arguments.html#Using-Header-Arguments" accesskey="p" rel="prev">Using Header Arguments</a>, Up: <a href="Working-with-Source-Code.html#Working-with-Source-Code" accesskey="u" rel="up">Working with Source Code</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Main-Index.html#Main-Index" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
