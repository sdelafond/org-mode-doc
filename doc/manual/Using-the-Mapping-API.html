<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- This manual is for Org version 9.3.

Copyright (C) 2004-2019  Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with no
Invariant Sections, with the Front-Cover Texts being "A GNU Manual,"
and with the Back-Cover Texts as in (a) below.  A copy of the license
is included in the section entitled "GNU Free Documentation License."

(a) The FSF's Back-Cover Text is: "You have the freedom to copy and
modify this GNU manual."
 -->
<!-- Created by GNU Texinfo 6.5, http://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Using the Mapping API (The Org Manual)</title>

<meta name="description" content="Using the Mapping API (The Org Manual)">
<meta name="keywords" content="Using the Mapping API (The Org Manual)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="index.html#Top" rel="start" title="Top">
<link href="Main-Index.html#Main-Index" rel="index" title="Main Index">
<link href="index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="Hacking.html#Hacking" rel="up" title="Hacking">
<link href="History-and-Acknowledgments.html#History-and-Acknowledgments" rel="next" title="History and Acknowledgments">
<link href="Using-the-Property-API.html#Using-the-Property-API" rel="prev" title="Using the Property API">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
blockquote.smallindentedblock {margin-right: 0em; font-size: smaller}
blockquote.smallquotation {font-size: smaller}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
div.smalldisplay {margin-left: 3.2em}
div.smallexample {margin-left: 3.2em}
div.smalllisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
pre.smalldisplay {font-family: inherit; font-size: smaller}
pre.smallexample {font-size: smaller}
pre.smallformat {font-family: inherit; font-size: smaller}
pre.smalllisp {font-size: smaller}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>


</head>

<body lang="en">
<a name="Using-the-Mapping-API"></a>
<div class="header">
<p>
Previous: <a href="Using-the-Property-API.html#Using-the-Property-API" accesskey="p" rel="prev">Using the Property API</a>, Up: <a href="Hacking.html#Hacking" accesskey="u" rel="up">Hacking</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Main-Index.html#Main-Index" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<a name="Using-the-Mapping-API-1"></a>
<h3 class="appendixsec">A.11 Using the Mapping API</h3>

<a name="index-API_002c-for-mapping"></a>
<a name="index-mapping-entries_002c-API"></a>

<p>Org has sophisticated mapping capabilities to find all entries
satisfying certain criteria.  Internally, this functionality is used
to produce agenda views, but there is also an API that can be used to
execute arbitrary functions for each or selected entries.  The main
entry point for this API is:
</p>
<dl>
<dt><a name="index-org_002dmap_002dentries"></a>Function: <strong>org-map-entries</strong> <em>func &amp;optional match scope &amp;rest skip</em></dt>
<dd><p>Call <var>FUNC</var> at each headline selected by <var>MATCH</var> in
<var>SCOPE</var>.
</p>
<p><var>FUNC</var> is a function or a Lisp form.  With point positioned
at the beginning of the headline, call the function without arguments.
Org returns an alist of return values of calls to the function.
</p>
<p>To avoid preserving point, Org wraps the call to <var>FUNC</var> in
<code>save-excursion</code> form.  After evaluation, Org moves point to the end
of the line that was just processed.  Search continues from that point
forward.  This may not always work as expected under some conditions,
such as if the current sub-tree was removed by a previous archiving
operation.  In such rare circumstances, Org skips the next entry
entirely when it should not.  To stop Org from such skips, make
<var>FUNC</var> set the variable <code>org-map-continue-from</code> to a specific
buffer position.
</p>
<p><var>MATCH</var> is a tags/property/TODO match.  Org iterates only
matched headlines.  Org iterates over all headlines when
<var>MATCH</var> is <code>nil</code> or <code>t</code>.
</p>
<p><var>SCOPE</var> determines the scope of this command.  It can be any
of:
</p>
<dl compact="compact">
<dt><code>nil</code></dt>
<dd><p>The current buffer, respecting the restriction, if any.
</p>
</dd>
<dt><code>tree</code></dt>
<dd><p>The subtree started with the entry at point.
</p>
</dd>
<dt><code>region</code></dt>
<dd><p>The entries within the active region, if any.
</p>
</dd>
<dt><code>file</code></dt>
<dd><p>The current buffer, without restriction.
</p>
</dd>
<dt><code>file-with-archives</code></dt>
<dd><p>The current buffer, and any archives associated with it.
</p>
</dd>
<dt><code>agenda</code></dt>
<dd><p>All agenda files.
</p>
</dd>
<dt><code>agenda-with-archives</code></dt>
<dd><p>All agenda files with any archive files associated with them.
</p>
</dd>
<dt>list of filenames</dt>
<dd><p>If this is a list, all files in the list are scanned.
</p></dd>
</dl>

<p>The remaining arguments are treated as settings for the scanner&rsquo;s
skipping facilities.  Valid arguments are:
</p>
<dl compact="compact">
<dt><code>archive</code></dt>
<dd><p>Skip trees with the &lsquo;<samp>ARCHIVE</samp>&rsquo; tag.
</p>
</dd>
<dt><code>comment</code></dt>
<dd><p>Skip trees with the COMMENT keyword.
</p>
</dd>
<dt>function or Lisp form</dt>
<dd><a name="index-org_002dagenda_002dskip_002dfunction-2"></a>
<p>Used as value for <code>org-agenda-skip-function</code>, so whenever the
function returns <code>t</code>, <var>FUNC</var> is called for that entry and
search continues from the point where the function leaves it.
</p></dd>
</dl>
</dd></dl>

<p>The mapping routine can call any arbitrary function, even functions
that change meta data or query the property API (see <a href="Using-the-Property-API.html#Using-the-Property-API">Using the Property API</a>).  Here are some handy functions:
</p>
<dl>
<dt><a name="index-org_002dtodo-1"></a>Function: <strong>org-todo</strong> <em>&amp;optional arg</em></dt>
<dd><p>Change the TODO state of the entry.  See the docstring of the
functions for the many possible values for the argument
<var>ARG</var>.
</p></dd></dl>

<dl>
<dt><a name="index-org_002dpriority-1"></a>Function: <strong>org-priority</strong> <em>&amp;optional action</em></dt>
<dd><p>Change the priority of the entry.  See the docstring of this function
for the possible values for <var>ACTION</var>.
</p></dd></dl>

<dl>
<dt><a name="index-org_002dtoggle_002dtag"></a>Function: <strong>org-toggle-tag</strong> <em>tag &amp;optional onoff</em></dt>
<dd><p>Toggle the tag <var>TAG</var> in the current entry.  Setting
<var>ONOFF</var> to either <code>on</code> or <code>off</code> does not toggle tag, but
ensure that it is either on or off.
</p></dd></dl>

<dl>
<dt><a name="index-org_002dpromote"></a>Function: <strong>org-promote</strong></dt>
<dd><p>Promote the current entry.
</p></dd></dl>

<dl>
<dt><a name="index-org_002ddemote"></a>Function: <strong>org-demote</strong></dt>
<dd><p>Demote the current entry.
</p></dd></dl>

<p>This example turns all entries tagged with &lsquo;<samp>TOMORROW</samp>&rsquo; into TODO
entries with keyword &lsquo;<samp>UPCOMING</samp>&rsquo;.  Org ignores entries in comment trees
and archive trees.
</p>
<div class="lisp">
<pre class="lisp">(org-map-entries '(org-todo &quot;UPCOMING&quot;)
                 &quot;+TOMORROW&quot; 'file 'archive 'comment)
</pre></div>

<p>The following example counts the number of entries with TODO keyword
&lsquo;<samp>WAITING</samp>&rsquo;, in all agenda files.
</p>
<div class="lisp">
<pre class="lisp">(length (org-map-entries t &quot;/+WAITING&quot; 'agenda))
</pre></div>

<hr>
<div class="header">
<p>
Previous: <a href="Using-the-Property-API.html#Using-the-Property-API" accesskey="p" rel="prev">Using the Property API</a>, Up: <a href="Hacking.html#Hacking" accesskey="u" rel="up">Hacking</a> &nbsp; [<a href="index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Main-Index.html#Main-Index" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
